<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Pro Player Â· ç”¨æˆ·åé¦ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // ä½¿ç”¨ V9.x çš„é…ç½®
    const SUPABASE_URL = "https://ztesoqtztyheezualipa.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp0ZXNvcXR6dHloZWV6dWFsaXBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzMjk0OTQsImV4cCI6MjA4MzkwNTQ5NH0.rRJIduqiWd37I3w0i-tyKn1skmehLKcX4AOYc-i2cbI";
    window.sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>

  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif; padding: 20px; max-width: 500px; margin: auto; background: #f2f2f7; color: #333; }
    
    .header { text-align: center; margin-bottom: 25px; margin-top: 20px; }
    .logo { width: 70px; height: 70px; border-radius: 14px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 10px; }
    h2 { margin: 0; font-weight: 800; font-size: 22px; color: #1c1c1e; }
    p { color: #8e8e93; font-size: 13px; margin-top: 6px; line-height: 1.5; }

    .card { background: #fff; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 20px; }
    
    .input-group { margin-bottom: 20px; }
    label { display: block; font-size: 13px; color: #666; margin-bottom: 8px; font-weight: 700; }
    input, textarea, select { 
      width: 100%; padding: 14px; border: 1px solid #e5e5ea; border-radius: 12px; 
      font-size: 16px; box-sizing: border-box; background: #f9f9f9; -webkit-appearance: none; font-family: inherit;
    }
    input:focus, textarea:focus { border-color: #007aff; background: #fff; outline: none; }
    
    /* ä¸Šä¼ åŒºåŸŸ */
    .upload-box { 
      border: 2px dashed #ddd; border-radius: 12px; padding: 30px; text-align: center; 
      background: #fafafa; cursor: pointer; transition: all 0.2s; position: relative;
    }
    .upload-box.active { border-color: #007aff; background: #f0f7ff; }
    .upload-icon { font-size: 32px; margin-bottom: 5px; display: block; }
    .upload-tip { font-size: 12px; color: #999; }
    #previewImg { max-width: 100%; max-height: 200px; border-radius: 8px; display: none; margin-top: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

    /* åè®®å‹¾é€‰æ¡† */
    .agreement { display: flex; gap: 10px; align-items: flex-start; background: #f2f2f7; padding: 15px; border-radius: 12px; margin-bottom: 25px; }
    .agreement input { width: 18px; height: 18px; margin-top: 2px; flex-shrink: 0; }
    .agreement-text { font-size: 12px; color: #555; line-height: 1.6; text-align: justify; }

    .btn-submit { width: 100%; padding: 16px; background: #007aff; color: #fff; border: none; border-radius: 14px; font-size: 17px; font-weight: 700; cursor: pointer; transition: opacity 0.2s; box-shadow: 0 4px 12px rgba(0,122,255,0.3); }
    .btn-submit:disabled { background: #d1d1d6; color: #fff; cursor: not-allowed; box-shadow: none; }
    .btn-submit:active { opacity: 0.8; transform: scale(0.98); }

    .hidden { display: none; }
    .success-icon { font-size: 60px; margin-bottom: 20px; }
    footer { text-align: center; font-size: 11px; color: #ccc; margin-top: 40px; }
  </style>
</head>

<body>

<div class="header">
  <img src="https://img.icons8.com/color/96/mouse-pad.png" class="logo">
  <h2>Pro Player ä½“éªŒåé¦ˆ</h2>
  <p>æ¯ä¸€ä½ Pro Player çš„å£°éŸ³éƒ½å€¼å¾—è¢«å¬è§<br>æœŸå¾…æ‚¨çš„çœŸå®ä½“éªŒä¸åˆ†äº«</p>
</div>

<!-- æäº¤æˆåŠŸé¡µ -->
<div id="successPage" class="card hidden" style="text-align:center; padding:50px 20px;">
  <div class="success-icon">ğŸ‰</div>
  <h2 style="margin-bottom:10px;">æäº¤æˆåŠŸï¼</h2>
  <p>æ„Ÿè°¢æ‚¨çš„åˆ†äº«ï¼Œæ‚¨çš„åé¦ˆæ˜¯æˆ‘ä»¬è¿›æ­¥çš„åŠ¨åŠ›ã€‚<br>æˆ‘ä»¬ä¼šè®¤çœŸé˜…è¯»æ¯ä¸€æ¡å»ºè®®ã€‚</p>
</div>

<!-- è¡¨å•é¡µ -->
<div id="formPage" class="card">
  <div class="input-group">
    <label>æ‚¨çš„ç§°å‘¼ / ID <span style="color:red">*</span></label>
    <input id="userName" placeholder="ä¾‹å¦‚ï¼šAlex æˆ– å¾®ä¿¡æ˜µç§°">
  </div>

  <div class="input-group">
    <label>åˆ†äº«å¹³å°</label>
    <select id="platform">
      <option value="æœ‹å‹åœˆ">å¾®ä¿¡æœ‹å‹åœˆ</option>
      <option value="å°çº¢ä¹¦">å°çº¢ä¹¦</option>
      <option value="æŠ–éŸ³">æŠ–éŸ³</option>
      <option value="Bç«™">Bilibili</option>
      <option value="å¾®åš">å¾®åš</option>
      <option value="å…¶ä»–">å…¶ä»–</option>
    </select>
  </div>

  <div class="input-group">
    <label>ç¤¾äº¤è´¦å· / é“¾æ¥ (æ–¹ä¾¿æˆ‘ä»¬æ‰¾åˆ°æ‚¨)</label>
    <input id="socialId" placeholder="å¡«å†™å‘å¸ƒé¡µé“¾æ¥ æˆ– æ‚¨çš„è´¦å·ID">
  </div>

  <div class="input-group">
    <label>æˆªå›¾ä¸Šä¼  (æœ‹å‹åœˆ/å¸–å­æˆªå›¾) <span style="color:red">*</span></label>
    <div class="upload-box" onclick="document.getElementById('fileIn').click()">
      <div id="uploadPlaceholder">
        <span class="upload-icon">ğŸ“·</span>
        <span class="upload-tip">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡ (æ”¯æŒ JPG/PNG)</span>
      </div>
      <img id="previewImg">
    </div>
    <input type="file" id="fileIn" accept="image/*" style="display:none" onchange="handleFile(this)">
  </div>

  <div class="input-group">
    <label>ä½¿ç”¨ä½“éªŒ / å»ºè®® (é€‰å¡«)</label>
    <textarea id="content" rows="3" placeholder="é¼ æ ‡å«é¡ºæ»‘åº¦å¦‚ä½•ï¼ŸåŒ…è£…æ»¡æ„å—ï¼Ÿä»»ä½•å»ºè®®éƒ½å¯ä»¥å†™åœ¨è¿™é‡Œ..."></textarea>
  </div>

  <!-- æ³•å¾‹åè®® -->
  <div class="agreement">
    <input type="checkbox" id="agreeCheck" onchange="toggleBtn()">
    <div class="agreement-text">
      <strong>æˆæƒå£°æ˜ï¼š</strong><br>
      æˆ‘å·²çŸ¥æ™“å¹¶åŒæ„ï¼ŒPro Player å“ç‰Œæœ‰æƒå°†æˆ‘æœ¬æ¬¡æäº¤çš„åé¦ˆå†…å®¹ï¼ˆåŒ…å«ä½†ä¸é™äºæˆªå›¾ã€ç…§ç‰‡ã€æ–‡å­—è¯„ä»·ï¼‰ç”¨äºå®˜æ–¹æ¸ é“çš„å“ç‰Œå®£ä¼ ä¸å±•ç¤ºï¼ˆå¦‚å®˜ç½‘ã€å…¬ä¼—å·ã€ç¤¾äº¤åª’ä½“æ¨å¹¿ç­‰ï¼‰ã€‚æˆ‘ä»¬æ‰¿è¯ºå°†ä¸¥æ ¼ä¿æŠ¤æ‚¨çš„å…¶ä»–ä¸ªäººéšç§ä¿¡æ¯ã€‚
    </div>
  </div>

  <button id="submitBtn" class="btn-submit" disabled onclick="submitData()">ç¡®è®¤æäº¤</button>
</div>

<div class="footer">
  Pro Player System V1.0<br>
  Powered by Mars-è€åˆ˜ & AI
</div>

<script>
  let imgBase64 = null;

  // å›¾ç‰‡å¤„ç† (è½¬Base64 + é¢„è§ˆ)
  function handleFile(input) {
    const file = input.files[0];
    if (!file) return;

    // é™åˆ¶å¤§å° (5MB)
    if (file.size > 5 * 1024 * 1024) {
      alert("å›¾ç‰‡å¤ªå¤§å•¦ï¼Œè¯·ä¸Šä¼  5MB ä»¥å†…çš„å›¾ç‰‡");
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      // é¢„è§ˆ
      const img = document.getElementById('previewImg');
      img.src = e.target.result;
      img.style.display = 'block';
      document.getElementById('uploadPlaceholder').style.display = 'none';
      
      imgBase64 = e.target.result; 
    };
    reader.readAsDataURL(file);
  }

  // æŒ‰é’®å¼€å…³
  function toggleBtn() {
    const chk = document.getElementById('agreeCheck');
    const btn = document.getElementById('submitBtn');
    btn.disabled = !chk.checked;
  }

  // æäº¤é€»è¾‘
  async function submitData() {
    const name = document.getElementById('userName').value.trim();
    const plat = document.getElementById('platform').value;
    const social = document.getElementById('socialId').value.trim();
    const txt = document.getElementById('content').value.trim();
    const isAgree = document.getElementById('agreeCheck').checked;
    
    if (!name) return alert("è¯·å¡«å†™æ‚¨çš„ç§°å‘¼");
    if (!imgBase64) return alert("è¯·ä¸Šä¼ æˆªå›¾è¯æ˜");
    if (!isAgree) return alert("è¯·é˜…è¯»å¹¶åŒæ„æˆæƒå£°æ˜");

    const btn = document.getElementById('submitBtn');
    btn.innerText = "â³ æ­£åœ¨ä¸Šä¼ ...";
    btn.disabled = true;

    // å†™å…¥æ•°æ®åº“
    const { error } = await window.sb.from('feedbacks').insert({
      user_name: name,
      platform: plat,
      social_id: social,
      content: txt,
      image_data: imgBase64, // å­˜å…¥ Base64 å›¾ç‰‡
      consent: true
    });

    if (error) {
      console.error(error);
      alert("æäº¤å¤±è´¥ï¼Œè¯·ç¨åå†è¯• (å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜)");
      btn.innerText = "ç¡®è®¤æäº¤";
      btn.disabled = false;
    } else {
      // æˆåŠŸ
      document.getElementById('formPage').classList.add('hidden');
      document.getElementById('successPage').classList.remove('hidden');
    }
  }
</script>

</body>
</html>