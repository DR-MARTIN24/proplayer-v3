<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Pro Player Â· ç”¨æˆ·åé¦ˆä¸­å¿ƒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://ztesoqtztyheezualipa.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp0ZXNvcXR6dHloZWV6dWFsaXBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzMjk0OTQsImV4cCI6MjA4MzkwNTQ5NH0.rRJIduqiWd37I3w0i-tyKn1skmehLKcX4AOYc-i2cbI";
    window.sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>

  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif; padding: 20px; max-width: 600px; margin: auto; background: #f2f2f7; color: #333; padding-bottom: 60px; }
    
    .header { text-align: center; margin: 30px 0; }
    .logo { width: 70px; height: 70px; border-radius: 14px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 10px; }
    h2 { margin: 0; font-weight: 800; font-size: 22px; color: #1c1c1e; }
    p { color: #8e8e93; font-size: 13px; margin-top: 6px; }

    .card { background: #fff; padding: 24px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 20px; }
    
    .input-group { margin-bottom: 20px; }
    label { display: block; font-size: 13px; color: #666; margin-bottom: 8px; font-weight: 700; }
    input, textarea, select { 
      width: 100%; padding: 12px; border: 1px solid #e5e5ea; border-radius: 10px; 
      font-size: 15px; box-sizing: border-box; background: #f9f9f9; -webkit-appearance: none; font-family: inherit;
    }
    input:focus, textarea:focus { border-color: #007aff; background: #fff; outline: none; }

    /* å¤šå¹³å°åˆ—è¡¨ */
    .social-row { display: flex; gap: 8px; margin-bottom: 10px; }
    .social-select { flex: 1; }
    .social-input { flex: 2; }
    .btn-remove { width: 40px; background: #ff3b30; color: #fff; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    .btn-add { width: 100%; padding: 10px; border: 1px dashed #007aff; color: #007aff; background: #f0f7ff; border-radius: 10px; cursor: pointer; font-weight: 600; margin-top: 5px; }

    /* ä¼˜ç¼ºç‚¹æ¡† */
    .pros-box { border: 2px solid #34c759; background: #f0f9f4; }
    .cons-box { border: 2px solid #ff9500; background: #fff8f0; }
    .badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: bold; margin-bottom: 5px; }
    .badge-green { background: #34c759; color: #fff; }
    .badge-orange { background: #ff9500; color: #fff; }

    .upload-box { 
      border: 2px dashed #ddd; border-radius: 12px; padding: 30px; text-align: center; 
      background: #fafafa; cursor: pointer; transition: all 0.2s; position: relative;
    }
    #previewImg { max-width: 100%; max-height: 200px; border-radius: 8px; display: none; margin-top: 10px; }

    /* === æ ¸å¿ƒä¼˜åŒ–ï¼šè¶…æ˜æ˜¾å®å¿ƒè“å‹¾é€‰æ¡† === */
    .agreement { 
      display: flex; gap: 15px; align-items: flex-start; 
      background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 25px; 
      border: 1px solid #e5e5ea; cursor: pointer; transition: 0.2s;
    }
    .agreement:active { background: #f2f2f7; }

    /* éšè—åŸç”Ÿ checkbox */
    .agreement input[type="checkbox"] { 
      appearance: none; -webkit-appearance: none;
      width: 26px; height: 26px; flex-shrink: 0; margin-top: 2px;
      border: 2px solid #ccc; border-radius: 6px; background: #fff;
      display: flex; align-items: center; justify-content: center; transition: 0.2s;
    }
    
    /* é€‰ä¸­çŠ¶æ€ï¼šå®å¿ƒè“èƒŒæ™¯ + ç™½è‰²å¯¹å· */
    .agreement input[type="checkbox"]:checked {
      background-color: #007aff; border-color: #007aff;
    }
    .agreement input[type="checkbox"]:checked::after {
      content: 'âœ”'; font-size: 16px; color: #fff; font-weight: bold;
    }

    .agreement-text { font-size: 13px; color: #555; line-height: 1.6; text-align: justify; }
    .highlight { color: #007aff; font-weight: bold; }

    .btn-submit { width: 100%; padding: 16px; background: #007aff; color: #fff; border: none; border-radius: 14px; font-size: 17px; font-weight: 700; cursor: pointer; transition: opacity 0.2s; box-shadow: 0 4px 12px rgba(0,122,255,0.3); }
    .btn-submit:disabled { background: #d1d1d6; cursor: not-allowed; box-shadow: none; opacity: 0.7; }

    .hidden { display: none; }
    .footer { text-align: center; font-size: 11px; color: #ccc; margin-top: 30px; }
  </style>
</head>
<body>

<div class="header">
  <img src="https://img.icons8.com/color/96/mouse-pad.png" class="logo">
  <h2>Pro Player ç”¨æˆ·åé¦ˆä¸­å¿ƒ</h2>
  <p>æ‚¨çš„æ¯ä¸€ä¸ªè§‚ç‚¹ï¼Œéƒ½æ˜¯æˆ‘ä»¬è¿›åŒ–çš„åŠ¨åŠ›<br>
     <span style="color:#007aff; font-weight:bold;">æç¤ºï¼šä½¿ç”¨ç›¸åŒæ‰‹æœºå·æäº¤å¯è¦†ç›–æ›´æ–°èµ„æ–™</span>
  </p>
</div>

<div id="successPage" class="card hidden" style="text-align:center; padding:50px 20px;">
  <div style="font-size:50px;">ğŸ‰</div>
  <h2 style="margin:15px 0;">æäº¤æˆåŠŸ</h2>
  <p>æ‚¨çš„åé¦ˆå·²åŠ å¯†å­˜å‚¨ã€‚<br>æ„Ÿè°¢æ‚¨å¯¹ Pro Player çš„æ”¯æŒï¼</p>
  <button onclick="location.reload()" style="margin-top:20px; background:#f2f2f7; color:#333; border:none; padding:10px 20px; border-radius:8px;">è¿”å›</button>
</div>

<div id="formPage" class="card">
  <!-- 1. èº«ä»½ä¿¡æ¯ -->
  <div class="input-group">
    <label>ç™»å½•æ‰‹æœºå· (å”¯ä¸€èº«ä»½ID) <span style="color:red">*</span></label>
    <input type="tel" id="phone" maxlength="11" placeholder="ç”¨äºåç»­ä¿®æ”¹/è¦†ç›–èµ„æ–™ï¼Œè¯·åŠ¡å¿…å¡«å†™çœŸå®å·ç ">
  </div>
  
  <div class="input-group">
    <label>æ‚¨çš„ç§°å‘¼ / ID <span style="color:red">*</span></label>
    <input type="text" id="userName" placeholder="ä¾‹å¦‚ï¼šAlex æˆ– å¾®ä¿¡æ˜µç§°">
  </div>

  <!-- 2. å¤šå¹³å°é“¾æ¥ -->
  <div class="input-group">
    <label>ç¤¾äº¤åª’ä½“å‘å¸ƒä¿¡æ¯ (æ”¯æŒæ·»åŠ å¤šä¸ª)</label>
    <div id="socialList"></div>
    <button class="btn-add" onclick="addSocialRow()">+ æ·»åŠ ä¸€ä¸ªå¹³å°</button>
  </div>

  <!-- 3. åŸå§‹æ–‡æ¡ˆæ¬è¿ -->
  <div class="input-group">
    <label>ğŸ“‹ ç¤¾äº¤åª’ä½“åŸå§‹æ–‡æ¡ˆ (æ¬è¿)</label>
    <textarea id="rawText" rows="3" placeholder="åœ¨æ­¤ç²˜è´´æ‚¨å‘å¸ƒçš„æœ‹å‹åœˆæ–‡æ¡ˆã€å°çº¢ä¹¦é•¿æ–‡ç­‰..."></textarea>
  </div>

  <!-- 4. ä¼˜ç¼ºç‚¹åˆ†æµ -->
  <div class="input-group">
    <div class="badge badge-green">ä¼˜ç‚¹ / çˆ½ç‚¹</div>
    <textarea id="pros" class="pros-box" rows="2" placeholder="è§‰å¾—å“ªé‡Œå¥½ï¼Ÿ(æ»‘åº¦ã€åšå·¥ã€åŒ…è£…ç­‰)"></textarea>
  </div>

  <div class="input-group">
    <div class="badge badge-orange">ç¼ºç‚¹ / å»ºè®®</div>
    <textarea id="cons" class="cons-box" rows="2" placeholder="å“ªé‡Œéœ€è¦æ”¹è¿›ï¼Ÿè¯·ç›´è¨€ä¸è®³"></textarea>
  </div>

  <!-- 5. æˆªå›¾ä¸Šä¼  -->
  <div class="input-group">
    <label>å‘å¸ƒæˆªå›¾ (å¿…å¡«) <span style="color:red">*</span></label>
    <div class="upload-box" onclick="document.getElementById('fileIn').click()">
      <div id="uploadPlaceholder">ğŸ“· ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡</div>
      <img id="previewImg">
    </div>
    <input type="file" id="fileIn" accept="image/*" style="display:none" onchange="handleFile(this)">
  </div>

  <!-- 6. åè®®å‹¾é€‰ (ç‚¹å‡»æ•´è¡Œéƒ½å¯è§¦å‘) -->
  <div class="agreement" onclick="toggleCheck()">
    <input type="checkbox" id="agreeCheck" onclick="event.stopPropagation(); toggleBtn()">
    <div class="agreement-text">
      <strong>æˆæƒå£°æ˜ï¼š</strong><br>
      æˆ‘å·²çŸ¥æ™“å¹¶åŒæ„ï¼Œæäº¤å³ä»£è¡¨<span class="highlight">æˆæƒ Pro Player å“ç‰Œ</span>åœ¨å®˜æ–¹æ¸ é“ï¼ˆå®˜ç½‘ã€å…¬ä¼—å·ã€ç¤¾åª’ç­‰ï¼‰ä½¿ç”¨æˆ‘æäº¤çš„åé¦ˆå†…å®¹ï¼ˆæˆªå›¾ã€ç…§ç‰‡ã€è¯„ä»·ç­‰ï¼‰ç”¨äºå“ç‰Œå®£ä¼ ã€‚æˆ‘ä»¬æ‰¿è¯ºä»…å±•ç¤ºå†…å®¹ï¼Œä¸¥æ ¼ä¿æŠ¤æ‚¨çš„æ‰‹æœºå·ç­‰éšç§ä¿¡æ¯ã€‚
    </div>
  </div>

  <button id="submitBtn" class="btn-submit" disabled onclick="submitData()">ç¡®è®¤æäº¤</button>
</div>

<div class="footer">
  Pro Player System V3.1<br>
  Powered by Mars-è€åˆ˜ & AI
</div>

<script>
  let imgBase64 = null;
  const platforms = ["æœ‹å‹åœˆ", "å°çº¢ä¹¦", "æŠ–éŸ³", "Bç«™", "å¾®åš", "å¿«æ‰‹", "å…¶ä»–"];

  // åˆå§‹åŒ–æ·»åŠ ä¸€è¡Œ
  addSocialRow();

  function addSocialRow() {
    const div = document.createElement('div');
    div.className = 'social-row';
    let opts = platforms.map(p => `<option value="${p}">${p}</option>`).join('');
    div.innerHTML = `
      <select class="social-select">${opts}</select>
      <input class="social-input" placeholder="å¡«å†™è´¦å·IDæˆ–é“¾æ¥">
      <button class="btn-remove" onclick="this.parentElement.remove()">Ã—</button>
    `;
    document.getElementById('socialList').appendChild(div);
  }

  function handleFile(input) {
    const file = input.files[0];
    if (!file) return;
    if (file.size > 5 * 1024 * 1024) return alert("å›¾ç‰‡è¿‡å¤§ï¼Œè¯·ä¸Šä¼ 5MBä»¥å†…");
    const reader = new FileReader();
    reader.onload = function(e) {
      imgBase64 = e.target.result;
      document.getElementById('previewImg').src = imgBase64;
      document.getElementById('previewImg').style.display = 'block';
      document.getElementById('uploadPlaceholder').style.display = 'none';
    };
    reader.readAsDataURL(file);
  }

  // è¾…åŠ©ç‚¹å‡»é€»è¾‘
  function toggleCheck() {
    const chk = document.getElementById('agreeCheck');
    chk.checked = !chk.checked;
    toggleBtn();
  }

  function toggleBtn() {
    setTimeout(() => {
      document.getElementById('submitBtn').disabled = !document.getElementById('agreeCheck').checked;
    }, 50);
  }

  async function submitData() {
    const phone = document.getElementById('phone').value.trim();
    const name = document.getElementById('userName').value.trim();
    const raw = document.getElementById('rawText').value.trim();
    const pros = document.getElementById('pros').value.trim();
    const cons = document.getElementById('cons').value.trim();
    
    if (phone.length !== 11) return alert("è¯·è¾“å…¥11ä½æ‰‹æœºå·ä½œä¸ºID");
    if (!name) return alert("è¯·å¡«å†™ç§°å‘¼");
    if (!imgBase64) return alert("è¯·ä¸Šä¼ æˆªå›¾è¯æ˜");

    const socialRows = document.querySelectorAll('.social-row');
    const socialData = [];
    socialRows.forEach(row => {
      const plat = row.querySelector('select').value;
      const val = row.querySelector('input').value.trim();
      if(val) socialData.push({ platform: plat, value: val });
    });

    const btn = document.getElementById('submitBtn');
    btn.disabled = true; btn.innerText = "â³ æäº¤ä¸­...";

    // æäº¤æ‰€æœ‰å­—æ®µ
    const { error } = await window.sb.from('feedbacks').upsert({
      phone: phone,
      user_name: name,
      social_data: socialData,
      raw_text: raw,
      pros: pros,
      cons: cons,
      image_data: imgBase64,
      consent: true
    }, { onConflict: 'phone' });

    if (error) {
      alert("æäº¤å¤±è´¥: " + error.message);
      btn.disabled = false; btn.innerText = "ç¡®è®¤æäº¤";
    } else {
      document.getElementById('formPage').classList.add('hidden');
      document.getElementById('successPage').classList.remove('hidden');
      window.scrollTo(0,0);
    }
  }
</script>
</body>
</html>