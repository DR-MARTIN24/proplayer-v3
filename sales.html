<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Pro Player · 销售端 v4.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./config.js"></script>
  <style>
    body { font-family: system-ui; padding: 20px; }
    input, button { padding: 8px; margin: 6px 0; width: 100%; }
    .hidden { display: none; }
  </style>
</head>
<body>

<h2>Pro Player 销售系统</h2>

<div id="login">
  <h3>销售登录</h3>
  <input id="email" placeholder="邮箱" />
  <input id="password" type="password" placeholder="密码" />
  <button onclick="login()">登录</button>
  <p id="loginMsg"></p>
</div>

<div id="app" class="hidden">
  <h3>新建订单</h3>
  <input id="product" placeholder="产品名称" />
  <input id="qty" type="number" placeholder="数量" />
  <button onclick="submitOrder()">提交订单</button>

  <h3>我的订单</h3>
  <ul id="orders"></ul>

  <button onclick="logout()">退出登录</button>
</div>

<script>
let currentUser = null;

async function login() {
  const email = email.value;
  const password = password.value;

  const { data, error } = await supabase.auth.signInWithPassword({
    email, password
  });

  if (error) {
    loginMsg.innerText = error.message;
    return;
  }

  currentUser = data.user;
  login.classList.add("hidden");
  app.classList.remove("hidden");
  loadOrders();
}

async function loadOrders() {
  const { data, error } = await supabase
    .from("orders")
    .select("*")
    .order("created_at", { ascending: false });

  orders.innerHTML = "";
  data?.forEach(o => {
    const li = document.createElement("li");
    li.innerText = `${o.product} × ${o.qty}`;
    orders.appendChild(li);
  });
}

async function submitOrder() {
  await supabase.from("orders").insert({
    product: product.value,
    qty: qty.value,
    account: currentUser.email
  });
  loadOrders();
}

async function logout() {
  await supabase.auth.signOut();
  location.reload();
}
</script>

<footer style="margin-top:40px;font-size:12px;">
© Pro Player · 销售系统 v4.0  
<br>Developed by Mars-老刘 & ChatGPT  
<br>Version build: 2026-01-16  {{精确时间以你提交为准}}
</footer>

</body>
</html>
