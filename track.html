<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Pro Player Â· ç‰©æµæŸ¥è¯¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  
  <!-- æ ¸å¿ƒæ•°æ®åº“è¿æ¥åº“ -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script>
    // âœ… ç»§æ‰¿è‡ª V9.1/V9.2 çš„ç¨³å®šé…ç½®
    const SUPABASE_URL = "https://ztesoqtztyheezualipa.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp0ZXNvcXR6dHloZWV6dWFsaXBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzMjk0OTQsImV4cCI6MjA4MzkwNTQ5NH0.rRJIduqiWd37I3w0i-tyKn1skmehLKcX4AOYc-i2cbI";
    window.sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>

  <style>
    /* iOS é£æ ¼ç»Ÿä¸€ UI */
    body { font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif; padding: 20px; max-width: 500px; margin: auto; background: #f2f2f7; color: #1c1c1e; }
    
    .header { text-align: center; margin-bottom: 30px; margin-top: 20px; }
    .logo { width: 60px; height: 60px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 10px; }
    h2 { margin: 0; font-weight: 800; font-size: 22px; color: #333; }
    p { color: #8e8e93; font-size: 13px; margin-top: 5px; }

    .card { background: #fff; padding: 24px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.04); margin-bottom: 20px; }
    
    .search-box { display: flex; gap: 10px; align-items: center; margin-bottom: 20px; }
    .input-group { flex: 1; }
    label { display: block; font-size: 12px; color: #8e8e93; margin-bottom: 5px; font-weight: 600; text-align: center; }
    
    input { 
      width: 100%; padding: 14px; border: 1px solid #e5e5ea; border-radius: 12px; 
      font-size: 20px; font-weight: bold; text-align: center; box-sizing: border-box; 
      background: #f9f9f9; -webkit-appearance: none; letter-spacing: 2px;
    }
    input:focus { border-color: #007aff; background: #fff; outline: none; }

    .btn-main { width: 100%; padding: 16px; background: #007aff; color: #fff; border: none; border-radius: 14px; font-size: 17px; font-weight: 700; cursor: pointer; transition: transform 0.1s; box-shadow: 0 4px 12px rgba(0,122,255,0.3); }
    .btn-main:active { transform: scale(0.98); opacity: 0.9; }
    .btn-main:disabled { background: #d1d1d6; color: #fff; box-shadow: none; }

    /* ç»“æœåˆ—è¡¨æ ·å¼ */
    .result-item { border-bottom: 1px dashed #e5e5ea; padding: 15px 0; animation: fadeIn 0.5s ease; }
    .result-item:last-child { border-bottom: none; }
    
    .res-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .res-name { font-weight: 700; font-size: 16px; }
    .res-date { font-size: 12px; color: #999; }
    
    .res-detail { font-size: 14px; color: #666; margin-bottom: 10px; background: #f5f5f7; padding: 8px; border-radius: 8px; }
    
    .status-box { display: flex; align-items: center; justify-content: space-between; }
    .status-tag { font-size: 13px; font-weight: bold; padding: 4px 10px; border-radius: 6px; }
    .st-pending { background: #fff3cd; color: #856404; }
    .st-shipped { background: #d4edda; color: #155724; }
    
    .track-btn { font-size: 13px; color: #007aff; text-decoration: none; font-weight: bold; border: 1px solid #007aff; padding: 4px 12px; border-radius: 15px; }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .hidden { display: none; }
    .footer { text-align: center; font-size: 11px; color: #ccc; margin-top: 40px; }
  </style>
</head>

<body>

<div class="header">
  <img src="https://img.icons8.com/color/96/mouse-pad.png" class="logo" alt="Logo">
  <h2>Pro Player ç‰©æµæŸ¥è¯¢</h2>
  <p>è‡ªåŠ©æŸ¥è¯¢ Â· å®æ—¶è¿½è¸ª</p>
</div>

<div class="card">
  <div class="search-box">
    <div class="input-group" style="flex: 0.6;">
      <label>æ‰‹æœºå‰3ä½</label>
      <input type="tel" id="prefix" maxlength="3" placeholder="138">
    </div>
    <div style="font-weight:bold; color:#ccc; margin-top: 15px;">â€¢â€¢â€¢â€¢</div>
    <div class="input-group">
      <label>æ‰‹æœºå4ä½</label>
      <input type="tel" id="suffix" maxlength="4" placeholder="1234">
    </div>
  </div>
  
  <button id="searchBtn" class="btn-main" onclick="searchOrder()">ğŸ” ç«‹å³æŸ¥è¯¢</button>
</div>

<div id="resultBox" class="card hidden">
  <h3 style="margin:0 0 15px 0; font-size:16px; border-bottom:2px solid #f2f2f7; padding-bottom:10px;">ğŸ“¦ æŸ¥è¯¢ç»“æœ</h3>
  <div id="resultList"></div>
</div>

<div class="footer">
  Pro Player System V1.0<br>
  Powered by Mars-è€åˆ˜ & AI
</div>

<script>
  // æ ¸å¿ƒæŸ¥è¯¢é€»è¾‘
  async function searchOrder() {
    const pre = document.getElementById("prefix").value.trim();
    const suf = document.getElementById("suffix").value.trim();
    const btn = document.getElementById("searchBtn");
    const resBox = document.getElementById("resultBox");
    const list = document.getElementById("resultList");

    // 1. æ ¡éªŒè¾“å…¥
    if (pre.length !== 3 || suf.length !== 4) {
      alert("âŒ è¯·å®Œæ•´å¡«å†™æ‰‹æœºå·çš„å‰3ä½å’Œå4ä½");
      return;
    }

    btn.disabled = true;
    btn.innerText = "â³ æ­£åœ¨æŸ¥æ‰¾...";
    resBox.classList.add("hidden");
    list.innerHTML = "";

    // 2. æ•°æ®åº“æ¨¡ç³ŠåŒ¹é… (Like Query)
    // é€»è¾‘ï¼šæŸ¥æ‰¾ phone å­—æ®µé•¿å¾—åƒ "138%1234" çš„æ•°æ®
    const searchPattern = `${pre}%${suf}`;

    const { data, error } = await window.sb
      .from("orders")
      .select("*")
      .ilike("phone", searchPattern) // ilike å¿½ç•¥å¤§å°å†™ï¼Œæ”¯æŒæ¨¡ç³ŠåŒ¹é…
      .order("created_at", { ascending: false });

    btn.disabled = false;
    btn.innerText = "ğŸ” ç«‹å³æŸ¥è¯¢";

    if (error) {
      alert("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•");
      console.error(error);
      return;
    }

    // 3. æ¸²æŸ“ç»“æœ
    if (!data || data.length === 0) {
      alert("âš ï¸ æœªæ‰¾åˆ°ç›¸å…³è®¢å•\n\nè¯·æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦è¾“å…¥æ­£ç¡®ï¼Œ\næˆ–è”ç³»å®¢æœç¡®è®¤æ˜¯å¦ä¸‹å•ã€‚");
      return;
    }

    resBox.classList.remove("hidden");

    data.forEach(order => {
      // çŠ¶æ€åˆ¤æ–­
      const isShipped = !!order.tracking_number;
      
      // ç‰©æµçŠ¶æ€UI
      let statusBadge = isShipped 
        ? `<span class="status-tag st-shipped">å·²å‘è´§</span>` 
        : `<span class="status-tag st-pending">å¤‡è´§ä¸­</span>`;
      
      // æŒ‰é’®é€»è¾‘ï¼šåªæœ‰å‘è´§äº†æ‰æ˜¾ç¤ºè·³è½¬æŒ‰é’®
      let actionBtn = isShipped
        ? `<a href="https://www.baidu.com/s?wd=${order.tracking_number}" target="_blank" class="track-btn">æŸ¥çœ‹ç‰©æµ ></a>`
        : `<span style="font-size:12px; color:#999">ç­‰å¾…æ½æ”¶</span>`;

      // éšå»ä¸­é—´åå­—ä¿æŠ¤éšç§
      const safeName = order.customer_name.length > 1 
        ? order.customer_name[0] + "*" + (order.customer_name.length>2 ? order.customer_name.slice(-1) : "")
        : order.customer_name;

      const dateStr = new Date(order.created_at).toLocaleDateString();

      const html = `
        <div class="result-item">
          <div class="res-header">
            <span class="res-name">${safeName} (${pre}****${suf})</span>
            <span class="res-date">${dateStr}</span>
          </div>
          <div class="res-detail">
            å•†å“ï¼š${order.product}<br>
            æ•°é‡ï¼š${order.total_qty} å¼ 
          </div>
          <div class="status-box">
            ${statusBadge}
            ${actionBtn}
          </div>
        </div>
      `;
      list.innerHTML += html;
    });
  }
</script>

</body>
</html>