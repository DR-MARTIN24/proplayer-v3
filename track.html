<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Pro Player Â· ç‰©æµæŸ¥è¯¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script>
    // âœ… ç»§æ‰¿è‡ª V9.x çš„ç¨³å®šé…ç½®
    const SUPABASE_URL = "https://ztesoqtztyheezualipa.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp0ZXNvcXR6dHloZWV6dWFsaXBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzMjk0OTQsImV4cCI6MjA4MzkwNTQ5NH0.rRJIduqiWd37I3w0i-tyKn1skmehLKcX4AOYc-i2cbI";
    window.sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>

  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif; padding: 20px; max-width: 500px; margin: auto; background: #f2f2f7; color: #1c1c1e; }
    
    .header { text-align: center; margin-bottom: 30px; margin-top: 40px; }
    /* åˆ é™¤ logo æ ·å¼ï¼Œè°ƒæ•´æ ‡é¢˜é—´è· */
    h2 { margin: 0; font-weight: 800; font-size: 24px; color: #333; letter-spacing: -0.5px; }
    p { color: #8e8e93; font-size: 13px; margin-top: 5px; }

    .card { background: #fff; padding: 24px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.04); margin-bottom: 20px; }
    
    .search-box { display: flex; gap: 10px; align-items: center; margin-bottom: 20px; }
    .input-group { flex: 1; }
    label { display: block; font-size: 12px; color: #8e8e93; margin-bottom: 5px; font-weight: 600; text-align: center; }
    
    input { 
      width: 100%; padding: 14px; border: 1px solid #e5e5ea; border-radius: 12px; 
      font-size: 20px; font-weight: bold; text-align: center; box-sizing: border-box; 
      background: #f9f9f9; -webkit-appearance: none; letter-spacing: 2px;
    }
    input:focus { border-color: #007aff; background: #fff; outline: none; }

    .btn-main { width: 100%; padding: 16px; background: #007aff; color: #fff; border: none; border-radius: 14px; font-size: 17px; font-weight: 700; cursor: pointer; transition: transform 0.1s; box-shadow: 0 4px 12px rgba(0,122,255,0.3); }
    .btn-main:active { transform: scale(0.98); opacity: 0.9; }
    .btn-main:disabled { background: #d1d1d6; color: #fff; box-shadow: none; cursor: not-allowed; }

    .result-item { border-bottom: 1px dashed #e5e5ea; padding: 15px 0; animation: fadeIn 0.5s ease; }
    .result-item:last-child { border-bottom: none; }
    
    .res-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .res-name { font-weight: 700; font-size: 16px; }
    .res-date { font-size: 12px; color: #999; }
    
    .res-detail { font-size: 14px; color: #666; margin-bottom: 10px; background: #f5f5f7; padding: 12px; border-radius: 8px; }
    
    .tracking-box { display: flex; justify-content: space-between; align-items: center; background: #e8f5e9; padding: 8px 12px; border-radius: 8px; margin-top: 10px; border: 1px solid #c3e6cb; }
    .track-info { display: flex; flex-direction: column; }
    .track-label { font-size: 10px; color: #155724; font-weight: bold; margin-bottom: 2px; text-transform: uppercase; }
    .track-num { font-family: monospace; font-weight: bold; color: #155724; font-size: 15px; letter-spacing: 1px; }
    
    .copy-btn { font-size: 12px; color: #007aff; background: #fff; padding: 6px 12px; border-radius: 6px; cursor: pointer; border: 1px solid #007aff; font-weight: bold; transition: all 0.2s; }
    .copy-btn:active { background: #007aff; color: #fff; }

    .status-box { display: flex; align-items: center; justify-content: space-between; margin-top: 10px; }
    .status-tag { font-size: 13px; font-weight: bold; padding: 4px 10px; border-radius: 6px; }
    .st-pending { background: #fff3cd; color: #856404; }
    .st-shipped { background: #d4edda; color: #155724; }
    
    .track-link-btn { font-size: 13px; color: #fff; background: #007aff; text-decoration: none; font-weight: bold; padding: 6px 15px; border-radius: 15px; display: inline-block; box-shadow: 0 2px 5px rgba(0,122,255,0.2); }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .hidden { display: none; }
    .footer { text-align: center; font-size: 11px; color: #ccc; margin-top: 40px; }
  </style>
</head>

<body>

<div class="header">
  <!-- LOGO å·²ç§»é™¤ -->
  <h2>Pro Player ç‰©æµæŸ¥è¯¢</h2>
  <p>è‡ªåŠ©æŸ¥è¯¢ Â· å®æ—¶è¿½è¸ª</p>
</div>

<div class="card">
  <div class="search-box">
    <div class="input-group" style="flex: 0.6;">
      <label>æ‰‹æœºå‰3ä½</label>
      <input type="tel" id="prefix" maxlength="3" placeholder="138">
    </div>
    <div style="font-weight:bold; color:#ccc; margin-top: 15px;">â€¢â€¢â€¢â€¢</div>
    <div class="input-group">
      <label>æ‰‹æœºå4ä½</label>
      <input type="tel" id="suffix" maxlength="4" placeholder="1234">
    </div>
  </div>
  
  <button id="searchBtn" class="btn-main" onclick="searchOrder()">ğŸ” ç«‹å³æŸ¥è¯¢</button>
</div>

<div id="resultBox" class="card hidden">
  <h3 style="margin:0 0 15px 0; font-size:16px; border-bottom:2px solid #f2f2f7; padding-bottom:10px;">ğŸ“¦ æŸ¥è¯¢ç»“æœ</h3>
  <div id="resultList"></div>
</div>

<div class="footer">
  Pro Player System V1.2<br>
  Powered by Mars-è€åˆ˜ & AI
</div>

<script>
  async function searchOrder() {
    const pre = document.getElementById("prefix").value.trim();
    const suf = document.getElementById("suffix").value.trim();
    const btn = document.getElementById("searchBtn");
    const resBox = document.getElementById("resultBox");
    const list = document.getElementById("resultList");

    if (pre.length !== 3 || suf.length !== 4) {
      alert("âŒ è¯·å®Œæ•´å¡«å†™æ‰‹æœºå·çš„å‰3ä½å’Œå4ä½");
      return;
    }

    btn.disabled = true;
    btn.innerText = "â³ æ­£åœ¨æŸ¥æ‰¾...";
    resBox.classList.add("hidden");
    list.innerHTML = "";

    const searchPattern = `${pre}%${suf}`;

    const { data, error } = await window.sb
      .from("orders")
      .select("*")
      .ilike("phone", searchPattern)
      .order("created_at", { ascending: false });

    btn.disabled = false;
    btn.innerText = "ğŸ” ç«‹å³æŸ¥è¯¢";

    if (error) {
      console.error(error);
      alert("æŸ¥è¯¢æœåŠ¡æš‚ä¸å¯ç”¨ï¼Œè¯·è”ç³»å®¢æœã€‚\n(å¯èƒ½åŸå› : æ•°æ®åº“æƒé™æœªå¼€æ”¾)");
      return;
    }

    if (!data || data.length === 0) {
      alert("âš ï¸ æœªæ‰¾åˆ°ç›¸å…³è®¢å•\n\nè¯·æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦è¾“å…¥æ­£ç¡®ï¼Œ\næˆ–è”ç³»å®¢æœç¡®è®¤æ˜¯å¦ä¸‹å•ã€‚");
      return;
    }

    resBox.classList.remove("hidden");

    data.forEach(order => {
      const isShipped = !!order.tracking_number;
      
      let statusBadge = isShipped 
        ? `<span class="status-tag st-shipped">å·²å‘è´§</span>` 
        : `<span class="status-tag st-pending">å¤‡è´§ä¸­</span>`;
      
      let trackingSection = "";
      if (isShipped) {
        trackingSection = `
          <div class="tracking-box">
            <div class="track-info">
              <span class="track-label">ç‰©æµå•å·</span>
              <span class="track-num">${order.tracking_number}</span>
            </div>
            <div class="copy-btn" onclick="copyToClipboard('${order.tracking_number}')">å¤åˆ¶</div>
          </div>
        `;
      }

      let actionBtn = isShipped
        ? `<a href="https://www.baidu.com/s?wd=${order.tracking_number}" target="_blank" class="track-link-btn">æŸ¥çœ‹è½¨è¿¹ ></a>`
        : `<span style="font-size:12px; color:#999">ç­‰å¾…æ½æ”¶</span>`;

      const safeName = order.customer_name.length > 1 
        ? order.customer_name[0] + "*" + (order.customer_name.length>2 ? order.customer_name.slice(-1) : "")
        : order.customer_name;

      const dateStr = new Date(order.created_at).toLocaleDateString();

      const html = `
        <div class="result-item">
          <div class="res-header">
            <span class="res-name">${safeName} (${pre}****${suf})</span>
            <span class="res-date">${dateStr}</span>
          </div>
          <div class="res-detail">
            <div style="margin-bottom:4px">å•†å“ï¼š${order.product}</div>
            <div>æ•°é‡ï¼š${order.total_qty} å¼ </div>
            ${trackingSection}
          </div>
          <div class="status-box">
            ${statusBadge}
            ${actionBtn}
          </div>
        </div>
      `;
      list.innerHTML += html;
    });
  }

  function copyToClipboard(text) {
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    try {
      document.execCommand('copy');
      alert("âœ… å•å·å·²å¤åˆ¶: " + text);
    } catch (err) {
      alert("âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·é•¿æŒ‰å•å·æ‰‹åŠ¨å¤åˆ¶");
    }
    document.body.removeChild(textarea);
  }
</script>

</body>
</html>